<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e1b4b">
    <title>OhioID ULTRA MAX</title>
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel for Browser Rendering -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        html, body { position: fixed; overflow: hidden; width: 100%; height: 100%; -webkit-tap-highlight-color: transparent; }
        #root { height: 100%; overflow: hidden; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-top { padding-top: env(safe-area-inset-top, 0px); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 0px); }
        button, input, span, div { -webkit-user-select: none; user-select: none; }
        input { -webkit-user-select: text; user-select: text; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #F8FAFC; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        .slide-fade-in { animation: slideFadeIn 0.3s ease-out; }
        @keyframes slideFadeIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- INTERNAL ICON COMPONENT ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
                calc: "M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z M9 7h6v2H9V7z M9 11h2v2H9V11z M13 11h2v2h-2V11z M9 15h2v2H9V15z M13 15h2v2h-2V15z",
                stethoscope: "M4.8 2.3A.3.3 0 1 0 5 2a.3.3 0 0 0-.2.3ZM3 7V5a3 3 0 0 1 6 0v2h.5a2.5 2.5 0 0 1 0 5H9v2.5a4.5 4.5 0 0 1-9 0V12h.5a2.5 2.5 0 0 1 0-5H3Zm0 1H1a1.5 1.5 0 0 0 0 3h2V8Zm6 3V8H7v3h2ZM4 5a2 2 0 0 0-4 0v2h4V5Zm8.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z",
                dna: "m8 3 4 8 5-5 5 15H2L8 3z",
                check: "M20 6 9 17l-5-5",
                alert: "M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0zM12 9v4M12 17h.01",
                search: "M11 19a8 8 0 100-16 8 8 0 000 16zM21 21l-4.35-4.35",
                filter: "M22 3H2l8 9.46V19l4 2v-8.54L22 3z",
                bug: "M18 6l-2 2M6 6l2 2m10 8l2 2M6 16l-2 2M12 2v4m0 12v4M8 12a4 4 0 108 0 4 4 0 00-8 0z",
                book: "M4 19.5A2.5 2.5 0 016.5 17H20V3H6.5A2.5 2.5 0 004 5.5v14z",
                history: "M12 8v4l3 3M12 2a10 10 0 1010 10A10 10 0 0012 2z",
                briefcase: "M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2H3a2 2 0 00-2 2v9a2 2 0 002 2h18a2 2 0 002-2V9a2 2 0 00-2-2h-5zM10 5h4v2h-4V5z",
                right: "M9 18l6-6-6-6",
                left: "M15 18l-6-6 6-6",
                wind: "M17.7 7.7A2.5 2.5 0 1 1 20 12H4M19.3 16.3A2.5 2.5 0 1 0 17 12M2 8h10.5a2.5 2.5 0 1 1-2.5 2.5",
                droplets: "M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5s-3 3.5-3 5.5a7 7 0 0 0 7 7z",
                brain: "M9.5 2A4.5 4.5 0 0 0 5 6.5a4.5 4.5 0 0 0 4.5 4.5 4.5 4.5 0 0 0 4.5-4.5A4.5 4.5 0 0 0 9.5 2Zm5 11a4.5 4.5 0 0 0-4.5 4.5 4.5 4.5 0 0 0 4.5 4.5 4.5 4.5 0 0 0 4.5-4.5 4.5 4.5 0 0 0-4.5-4.5Z",
                heart: "M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",
                zap: "M13 2L3 14h9l-1 8 10-12h-9l1-8z",
                gauge: "M12 2a10 10 0 0 0-10 10 10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm1-8H7l4-4 2 4z",
                microscope: "M6 18h8M3 22h18M12 18a4 4 0 0 0 4-4V6H8v8a4 4 0 0 0 4 4zM12 2v4M7 8h10",
                list: "M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01",
                layers: "M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={icons[name] || icons['alert']} />
                </svg>
            );
        };

        // --- EXHAUSTIVE DATA TABLES ---
        const INFECTIONS = [
          // Respiratory
          { id: 'cap_no_comorbid', name: 'CAP (No Comorbidities)', category: 'Respiratory', icon: 'wind', escalate: 'Hypoxia, Sepsis, PSI Class IV/V' },
          { id: 'cap_comorbid', name: 'CAP (With Comorbidities)', category: 'Respiratory', icon: 'wind', escalate: 'Confusion, RR > 30, BUN > 20' },
          { id: 'hap', name: 'Hosp. Acquired Pneumonia', category: 'Respiratory', icon: 'wind', escalate: 'Intubation required, septic shock' },
          { id: 'sinusitis', name: 'Acute Bacterial Sinusitis', category: 'Respiratory', icon: 'wind', escalate: 'Orbital swelling, vision changes' },
          { id: 'otitis', name: 'Acute Otitis Media (Adult)', category: 'Respiratory', icon: 'stethoscope', escalate: 'Mastoiditis, CNS involvement' },
          
          // Urinary
          { id: 'cystitis', name: 'Uncomplicated Cystitis', category: 'Urinary', icon: 'droplets', escalate: 'Flank pain, fever' },
          { id: 'pyelo', name: 'Acute Pyelonephritis', category: 'Urinary', icon: 'droplets', escalate: 'Intractable vomiting' },
          { id: 'prostatitis', name: 'Acute Prostatitis', category: 'Urinary', icon: 'droplets', escalate: 'Urinary retention, bacteremia' },
          
          // GI
          { id: 'cdiff', name: 'C. difficile Infection', category: 'GI', icon: 'shield', escalate: 'Toxic Megacolon, WBC > 15k' },
          { id: 'sbp', name: 'SBP (Cirrhosis)', category: 'GI', icon: 'shield', escalate: 'Encephalopathy, Renal failure' },
          { id: 'diverticulitis', name: 'Diverticulitis', category: 'GI', icon: 'shield', escalate: 'Perforation, Abscess' },

          // Skin & Soft Tissue
          { id: 'cellulitis', name: 'Non-purulent Cellulitis', category: 'Skin/SSTI', icon: 'dna', escalate: 'Rapid progression' },
          { id: 'ssti_purulent', name: 'Purulent SSTI (MRSA)', category: 'Skin/SSTI', icon: 'dna', escalate: 'Large abscess >5cm' },
          { id: 'necfasc', name: 'Necrotizing Fasciitis', category: 'Skin/SSTI', icon: 'shield', escalate: 'Crepitus, Pain out of proportion' },

          // High Acuity
          { id: 'meningitis', name: 'Bacterial Meningitis', category: 'CNS', icon: 'brain', escalate: 'Seizures, GCS drop' },
          { id: 'endocarditis', name: 'Endocarditis (Empiric)', category: 'Cardio', icon: 'heart', escalate: 'New murmur, stroke signs' },
          { id: 'lyme', name: 'Lyme Disease (Early)', category: 'Vector', icon: 'zap', escalate: 'Heart block, facial palsy' },

          // STI
          { id: 'sti_gc', name: 'Gonorrhea', category: 'STI', icon: 'shield', escalate: 'Disseminated infection' },
          { id: 'sti_ct', name: 'Chlamydia', category: 'STI', icon: 'shield', escalate: 'Pelvic Inflammatory Disease' }
        ];

        const ANTIMICROBIALS = {
          amoxicillin: { name: 'Amoxicillin', class: 'Penicillin', spectrum: 1, renalLimit: 10, pedsDose: '90 mg/kg/d', monitoring: 'None' },
          amox_clav: { name: 'Amox-Clav (Augmentin)', class: 'Penicillin/BLI', spectrum: 2, renalLimit: 10, pedsDose: '45-90 mg/kg/d', monitoring: 'Diarrhea' },
          ceftriaxone: { name: 'Ceftriaxone', class: 'Ceph 3rd', spectrum: 3, renalLimit: 0, pedsDose: '50-100 mg/kg QD', monitoring: 'Standard' },
          cefepime: { name: 'Cefepime', class: 'Ceph 4th', spectrum: 4, renalLimit: 20, pedsDose: '50 mg/kg q8h', monitoring: 'Neuro/Renal' },
          vancomycin: { name: 'Vancomycin', class: 'Glycopeptide', spectrum: 4, renalLimit: 15, pedsDose: '15 mg/kg q8h', monitoring: 'AUC/Trough' },
          nitrofurantoin: { name: 'Nitrofurantoin', class: 'Nitrofuran', spectrum: 1, renalLimit: 30, pedsDose: '5-7 mg/kg/d', monitoring: 'CrCl check' },
          doxycycline: { name: 'Doxycycline', class: 'Tetracycline', spectrum: 2, renalLimit: 0, pedsDose: '2.2 mg/kg BID', monitoring: 'Photosens.' },
          pip_tazo: { name: 'Pip/Tazo (Zosyn)', class: 'BL/BLI', spectrum: 4, renalLimit: 20, pedsDose: '100 mg/kg q8h', monitoring: 'Cr, Plt' },
          levofloxacin: { name: 'Levofloxacin', class: 'Fluoroquinolone', spectrum: 4, renalLimit: 30, pedsDose: '10 mg/kg BID', monitoring: 'QTc, Tendon' },
          fidaxomicin: { name: 'Fidaxomicin', class: 'Macrolide', spectrum: 1, renalLimit: 0, pedsDose: 'N/A', monitoring: 'Standard' }
        };

        const REGIMENS = {
          cap_no_comorbid: [{ drugId: 'amoxicillin', line: 1, dose: '1g PO TID', duration: 5, note: 'Healthy adult.' }],
          cap_comorbid: [{ drugId: 'amox_clav', line: 1, dose: '875/125mg PO BID', duration: 7, note: '+ Azithromycin/Doxy.' }],
          hap: [{ drugId: 'cefepime', line: 1, dose: '2g IV q8h', duration: 7, note: 'Pseudomonas coverage.' }, { drugId: 'vancomycin', line: 1, dose: '15mg/kg q8h', duration: 7, note: 'MRSA coverage.' }],
          cdiff: [{ drugId: 'fidaxomicin', line: 1, dose: '200mg PO BID', duration: 10, note: 'IDSA Preferred.' }],
          prostatitis: [{ drugId: 'levofloxacin', line: 1, dose: '500mg PO QD', duration: 28, note: 'Prostate penetration.' }],
          endocarditis: [{ drugId: 'vancomycin', line: 1, dose: '15-20mg/kg q12h', duration: 42, note: 'Empiric coverage.' }],
          lyme: [{ drugId: 'doxycycline', line: 1, dose: '100mg PO BID', duration: 14, note: 'Standard EM.' }]
        };

        const STEWARDSHIP_ESSENTIALS = [
          { title: "IV-to-PO Switch", desc: "Transition patients when afebrile for 24h, stable vitals, and GI functional. Prevents line infections.", icon: "zap" },
          { title: "Spectrum Narrowing", desc: "Stop broad empiric therapy (Vanc/Zosyn) as soon as culture results identify the bug.", icon: "filter" },
          { title: "Double Anaerobe Warning", desc: "Pip/Tazo covers anaerobes; do not add Metronidazole. Redundant coverage increases toxicity.", icon: "shield" },
          { title: "Penicillin Allergy", desc: "90% of documented allergies are false. Re-assess to avoid toxic alternative agents.", icon: "alert" },
          { title: "MRSA Nares Utility", desc: "A negative MRSA PCR has a 98% NPV for pneumonia; safely stop Vancomycin.", icon: "microscope" },
          { title: "Culture Timing", desc: "Obtain cultures BEFORE the first dose to maximize diagnostic yield.", icon: "history" }
        ];

        const PATHOGEN_PROFILES = [
          { group: 'Gram Positive Cocci', examples: 'S. aureus, Strep, Enterococcus', morphology: 'Purple Clusters/Chains', site: 'Skin, Heart, Lungs' },
          { group: 'Gram Negative Rods', examples: 'E. coli, Pseudomonas, Klebsiella', morphology: 'Pink Bacilli', site: 'UTI, HAP, GI' },
          { group: 'Atypicals', examples: 'Mycoplasma, Legionella', morphology: 'No Cell Wall', site: 'Lungs, STI' }
        ];

        // --- MAIN APP LOGIC ---

        const ConsultView = ({ patient, setPatient, crCl, logAction }) => {
          const [selectedInf, setSelectedInf] = useState(INFECTIONS[0]);
          const [searchQuery, setSearchQuery] = useState('');
          const filtered = useMemo(() => INFECTIONS.filter(inf => 
            inf.name.toLowerCase().includes(searchQuery.toLowerCase()) || 
            inf.category.toLowerCase().includes(searchQuery.toLowerCase())
          ), [searchQuery]);

          const selectInfection = (inf) => {
            setSelectedInf(inf);
            logAction(`Consulted: ${inf.name}`);
          };

          return (
            <div className="p-4 space-y-4 pb-32 animate-in fade-in">
              <div className="bg-white p-5 rounded-[2.5rem] shadow-sm border border-slate-100">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Acute Patient Guard</h3>
                  <div className={`px-3 py-1 rounded-full text-[10px] font-black ${crCl < 30 ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}`}>
                    CrCl: {crCl} mL/min
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-3 mb-4">
                  <button onClick={() => setPatient(p => ({...p, isPediatric: !p.isPediatric}))} className={`p-4 rounded-2xl border flex items-center justify-center gap-2 transition-all active:scale-95 ${patient.isPediatric ? 'bg-indigo-600 text-white border-indigo-600 shadow-lg' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>
                    <Icon name="zap" size={16} />
                    <span className="text-xs font-bold">{patient.isPediatric ? 'Peds' : 'Adult'}</span>
                  </button>
                  <div className="bg-slate-50 rounded-2xl border border-slate-200 p-2 flex items-center justify-between px-4">
                     <span className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Sex</span>
                     <button onClick={() => setPatient(p => ({...p, sex: p.sex === 'male' ? 'female' : 'male'}))} className="text-xs font-bold text-indigo-600 uppercase underline">{patient.sex}</button>
                  </div>
                </div>
                <div className="flex gap-4">
                  <div className="flex-1"><label className="text-[10px] text-slate-400 font-bold uppercase block mb-1">Wt (kg)</label><input type="number" inputMode="decimal" value={patient.weight} onChange={e => setPatient(p => ({...p, weight: e.target.value}))} className="w-full bg-slate-50 p-3 rounded-xl text-sm border border-slate-100 outline-none" /></div>
                  <div className="flex-1"><label className="text-[10px] text-slate-400 font-bold uppercase block mb-1">Cr</label><input type="number" inputMode="decimal" step="0.1" value={patient.creatinine} onChange={e => setPatient(p => ({...p, creatinine: e.target.value}))} className="w-full bg-slate-50 p-3 rounded-xl text-sm border border-slate-100 outline-none" /></div>
                </div>
              </div>

              <div className="relative">
                <Icon name="search" size={16} className="absolute left-4 top-4 text-slate-400" />
                <input type="text" placeholder="Search exhaustive protocols..." className="w-full bg-white border border-slate-100 p-4 pl-12 rounded-2xl text-sm shadow-sm outline-none" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} />
              </div>

              <div className="flex overflow-x-auto gap-2 pb-2 scrollbar-hide snap-x">
                {filtered.map(inf => (
                  <button key={inf.id} onClick={() => selectInfection(inf)} className={`flex-shrink-0 p-4 px-6 rounded-2xl border transition-all min-w-[140px] snap-start active:scale-95 ${selectedInf.id === inf.id ? 'bg-slate-900 border-slate-900 shadow-lg text-white' : 'bg-white border-slate-100 text-slate-700'}`}>
                    <div className={`flex justify-center mb-1 ${selectedInf.id === inf.id ? 'text-indigo-300' : 'text-slate-400'}`}><Icon name={inf.icon} size={16} /></div>
                    <p className="text-[10px] font-bold">{inf.name}</p>
                  </button>
                ))}
              </div>

              <div className="space-y-4">
                {REGIMENS[selectedInf.id]?.map((reg, idx) => {
                  const drug = ANTIMICROBIALS[reg.drugId];
                  const unsafe = crCl < drug.renalLimit;
                  return (
                    <div key={idx} className={`bg-white rounded-[2.5rem] p-6 border shadow-sm relative overflow-hidden transition-all ${unsafe ? 'border-red-200 bg-red-50/20' : 'border-slate-100'}`}>
                      <div className="flex justify-between items-start mb-4">
                        <div>
                          <span className={`text-[9px] font-black px-2 py-0.5 rounded-full uppercase ${reg.line === 1 ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}`}>{reg.line === 1 ? 'First Line' : 'Alternative'}</span>
                          <h5 className="text-xl font-black text-slate-800 mt-1 tracking-tight">{drug.name}</h5>
                        </div>
                        <div className="text-right">
                          <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Days</p>
                          <p className="text-lg font-black text-indigo-600">{reg.duration || '??'}d</p>
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-2 mb-4">
                        <div className="bg-slate-50 p-4 rounded-3xl"><p className="text-[9px] font-bold text-slate-400 uppercase mb-1">Dose</p><p className="text-sm font-bold text-slate-900 leading-tight">{patient.isPediatric ? drug.pedsDose : reg.dose}</p></div>
                        <div className="bg-slate-50 p-4 rounded-3xl"><p className="text-[9px] font-bold text-slate-400 uppercase mb-1">Monitoring</p><p className="text-sm font-bold text-slate-700 truncate">{drug.monitoring}</p></div>
                      </div>
                      <div className="flex gap-3 p-4 bg-indigo-50/50 rounded-3xl border border-indigo-100">
                        <Icon name="briefcase" size={16} className="text-indigo-600 shrink-0" />
                        <p className="text-[11px] text-indigo-800 font-medium italic">"{reg.note}"</p>
                      </div>
                      {unsafe && <div className="p-3 bg-red-600 rounded-2xl flex items-center gap-2 mt-3 shadow-lg animate-pulse"><Icon name="shield" size={16} className="text-white" /><span className="text-[10px] text-white font-black uppercase">Renal Guard: CrCl &lt; {drug.renalLimit}</span></div>}
                    </div>
                  );
                }) || <div className="p-10 text-center text-slate-400 italic bg-white rounded-3xl border border-dashed">Protocol pending for {selectedInf.name}.</div>}
                
                <div className="bg-amber-50 p-6 rounded-[2.5rem] border border-amber-200 shadow-sm mb-12">
                   <div className="flex items-center gap-2 mb-2 text-amber-800"><Icon name="alert" size={18} /><h4 className="text-xs font-black uppercase tracking-widest">Escalate Trigger</h4></div>
                   <p className="text-xs font-bold text-amber-900 leading-tight">{selectedInf.escalate}</p>
                </div>
              </div>
            </div>
          );
        };

        const SepsisTool = ({ logAction }) => {
          const [state, setState] = useState({ bp: false, rr: false, mental: false });
          const score = Object.values(state).filter(v => v).length;
          
          useEffect(() => {
            if (score >= 2) logAction("High Risk Sepsis Flagged");
          }, [score]);

          return (
            <div className="p-4 space-y-4 pb-32 overflow-y-auto h-full scrollbar-hide">
               <div className="bg-slate-950 p-8 pt-12 rounded-[3.5rem] text-white shadow-2xl relative overflow-hidden">
                  <div className="absolute right-0 bottom-0 opacity-10"><Icon name="gauge" size={120} /></div>
                  <h2 className="text-3xl font-black tracking-tighter leading-none mb-1">Sepsis<br/>First Hour</h2>
                  <p className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">qSOFA Decision Tool</p>
               </div>
               <div className="bg-white p-6 rounded-[2.5rem] shadow-sm space-y-4 border border-slate-100">
                  <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest px-2">Assessment</h3>
                  {[{id:'bp',label:'SBP ≤ 100', icon:'calc'}, {id:'rr',label:'RR ≥ 22',icon:'wind'}, {id:'mental',label:'AMS Present',icon:'brain'}].map(item => (
                    <button key={item.id} onClick={() => setState({...state,[item.id]:!state[item.id]})} className={`w-full flex justify-between items-center p-6 rounded-3xl border-2 transition-all ${state[item.id] ? 'bg-indigo-600 border-indigo-600 text-white' : 'bg-slate-50'}`}>
                      <div className="flex items-center gap-4"><Icon name={item.icon} size={20}/><span className="font-bold text-sm">{item.label}</span></div>
                      {state[item.id] && <Icon name="check" size={24} />}
                    </button>
                  ))}
               </div>
               <div className={`p-8 rounded-[3.5rem] text-center shadow-lg transition-all ${score >= 2 ? 'bg-red-600 text-white' : 'bg-blue-600 text-white'}`}>
                  <h4 className="text-xl font-black mb-2">{score >= 2 ? 'HIGH RISK: SEPSIS' : 'Low Risk Indication'}</h4>
                  <p className="text-xs opacity-90 leading-relaxed font-medium">{score >= 2 ? "Initiate Bundle: IV Fluids, Cultures, Lactic Acid, Empiric Antibiotics." : "Standard care. Monitor vitals."}</p>
               </div>
            </div>
          );
        };

        const PathogenSearch = ({ logAction }) => {
          const [query, setQuery] = useState('');
          const bugs = [
            { name: 'MRSA', drugs: ['Vancomycin', 'Linezolid'], notes: 'Standard in Central Ohio for purulent SSTI.' },
            { name: 'Pseudomonas', drugs: ['Cefepime', 'Pip/Tazo', 'Meropenem'], notes: 'Critical for HAP and Neutropenia.' },
            { name: 'ESBL E. coli', drugs: ['Meropenem', 'Ertapenem'], notes: 'Rising outpatient prevalence.' },
            { name: 'S. pneumoniae', drugs: ['Amoxicillin', 'Ceftriaxone'], notes: 'High macrolide resistance locally.' }
          ];
          const filtered = bugs.filter(b => b.name.toLowerCase().includes(query.toLowerCase()));
          return (
            <div className="p-4 space-y-4 pb-32 h-full overflow-y-auto scrollbar-hide">
               <div className="relative">
                  <Icon name="search" size={18} className="absolute left-4 top-4 text-slate-400" />
                  <input type="text" placeholder="Search Pathogen (e.g. Pseudomonas)..." className="w-full bg-white border border-slate-100 p-4 pl-12 rounded-3xl text-sm shadow-sm outline-none" value={query} onChange={e => setQuery(e.target.value)} />
               </div>
               <div className="space-y-3">
                  {filtered.map((b, i) => (
                    <div key={i} className="bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-sm" onClick={() => logAction(`Bugs: ${b.name}`)}>
                       <div className="flex justify-between items-center mb-4"><h4 className="text-lg font-black text-slate-800 tracking-tight">{b.name}</h4><Icon name="microscope" size={18} className="text-indigo-400" /></div>
                       <div className="flex flex-wrap gap-2">{b.drugs.map((d, j) => (<span key={j} className="bg-indigo-50 text-indigo-700 text-[10px] font-black px-3 py-1.5 rounded-full uppercase tracking-wider">{d}</span>))}</div>
                       <p className="text-[11px] text-slate-500 italic mt-3">"{b.notes}"</p>
                    </div>
                  ))}
               </div>
            </div>
          );
        };

        const KnowledgeHub = ({ logAction }) => {
          const [showAll, setShowAll] = useState(false);
          const [idx, setIdx] = useState(0);
          const current = STEWARDSHIP_ESSENTIALS[idx];

          const toggleMode = () => {
             setShowAll(!showAll);
             logAction(showAll ? "Essentials: Focus" : "Essentials: See All");
          };

          return (
            <div className="p-4 space-y-6 pb-32 h-full overflow-y-auto scrollbar-hide">
               <div className="bg-indigo-600 p-8 pt-12 rounded-[4rem] text-white shadow-2xl relative overflow-hidden">
                  <div className="absolute -right-4 -top-4 opacity-10"><Icon name="dna" size={120} /></div>
                  <h2 className="text-3xl font-black tracking-tighter leading-none">Knowledge<br/>Base</h2>
                  <p className="text-indigo-100 text-[10px] mt-2 uppercase font-black tracking-widest opacity-80 underline underline-offset-4">Clinician Brief</p>
               </div>
               
               <section className="space-y-4">
                  <div className="flex items-center justify-between px-2">
                     <div className="flex items-center gap-2"><Icon name="shield" size={14} className="text-indigo-500"/><h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Stewardship Essentials</h3></div>
                     <button onClick={toggleMode} className="bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-[10px] font-black uppercase active:scale-95 transition-transform">{showAll ? "Focus One" : "See All"}</button>
                  </div>
                  {!showAll ? (
                    <div className="animate-in zoom-in-95">
                      <div className="bg-white p-7 rounded-[3rem] border border-slate-100 shadow-xl relative overflow-hidden group">
                         <div className="absolute -right-6 -bottom-6 opacity-5 text-indigo-900 group-hover:scale-110 transition-transform"><Icon name={current.icon} size={80}/></div>
                         <div className="flex justify-between items-start mb-6"><div className="w-12 h-12 bg-indigo-600 text-white rounded-2xl flex items-center justify-center shadow-lg"><Icon name={current.icon} size={24}/></div><div className="text-[10px] font-black text-slate-300 font-mono tracking-widest">{idx + 1} / {STEWARDSHIP_ESSENTIALS.length}</div></div>
                         <h4 className="text-xl font-black text-slate-800 tracking-tight mb-3">{current.title}</h4>
                         <p className="text-sm text-slate-500 leading-relaxed font-medium">{current.desc}</p>
                         <div className="flex gap-2 mt-8"><button onClick={() => setIdx(p => (p - 1 + STEWARDSHIP_ESSENTIALS.length) % STEWARDSHIP_ESSENTIALS.length)} className="flex-1 bg-slate-100 text-slate-600 p-4 rounded-2xl flex items-center justify-center active:scale-95 transition-all"><Icon name="left" size={20}/></button><button onClick={() => setIdx(p => (p + 1) % STEWARDSHIP_ESSENTIALS.length)} className="flex-[2] bg-indigo-950 text-white p-4 rounded-2xl flex items-center justify-center gap-2 font-black text-xs uppercase tracking-widest active:scale-95 transition-all shadow-lg">Next Pearl <Icon name="right" size={16}/></button></div>
                      </div>
                    </div>
                  ) : (
                    <div className="space-y-3 animate-in fade-in">
                       {STEWARDSHIP_ESSENTIALS.map((item, i) => (
                         <div key={i} className="bg-white p-5 rounded-[2rem] border border-slate-100 shadow-sm flex gap-4 items-start">
                            <div className="w-10 h-10 bg-indigo-50 rounded-2xl flex items-center justify-center shrink-0 text-indigo-600"><Icon name={item.icon} size={20}/></div>
                            <div><h4 className="font-bold text-slate-800 text-sm tracking-tight">{item.title}</h4><p className="text-[11px] text-slate-500 mt-1 leading-relaxed font-medium">{item.desc}</p></div>
                         </div>
                       ))}
                    </div>
                  )}
               </section>
               
               <section className="space-y-3">
                  <div className="flex items-center gap-2 px-2"><Icon name="microscope" size={14} className="text-green-500"/><h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Pathogen Morphology</h3></div>
                  <div className="grid grid-cols-1 gap-2">
                     {PATHOGEN_PROFILES.map((p, i) => (
                       <div key={i} className="bg-white p-5 rounded-3xl border border-slate-100 shadow-sm"><div className="flex justify-between items-center mb-2"><h4 className="font-black text-indigo-900 tracking-tight">{p.group}</h4><span className="text-[9px] font-black bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full uppercase">{p.morphology}</span></div><div className="grid grid-cols-2 gap-4"><div><p className="text-[9px] text-slate-400 font-black uppercase tracking-tighter">Sites</p><p className="text-xs text-slate-700 font-semibold">{p.site}</p></div><div><p className="text-[9px] text-slate-400 font-black uppercase tracking-tighter">Examples</p><p className="text-xs text-slate-700 font-semibold italic">{p.examples}</p></div></div></div>
                     ))}
                  </div>
               </section>
            </div>
          );
        };

        const LogsView = ({ logs, clearLogs }) => (
          <div className="p-4 space-y-4 pb-32 h-full overflow-y-auto scrollbar-hide">
            <div className="bg-slate-900 p-8 pt-12 rounded-[4rem] text-white shadow-2xl relative overflow-hidden">
               <div className="absolute right-0 bottom-0 opacity-10"><Icon name="history" size={120} /></div>
               <h2 className="text-3xl font-black tracking-tighter leading-none mb-1">Shift<br/>Activity</h2>
               <p className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Documentation Audit Trail</p>
            </div>
            
            <div className="flex justify-between px-2">
               <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Recent Actions</h3>
               <button onClick={clearLogs} className="text-[10px] font-black text-red-500 uppercase">Clear All</button>
            </div>

            <div className="space-y-2">
               {logs.length > 0 ? logs.map((log, i) => (
                 <div key={i} className="bg-white p-4 rounded-3xl border border-slate-100 flex justify-between items-center">
                    <div className="flex items-center gap-3">
                       <div className="w-2 h-2 bg-indigo-500 rounded-full"></div>
                       <span className="text-xs font-bold text-slate-700">{log.text}</span>
                    </div>
                    <span className="text-[9px] font-mono text-slate-300">{log.time}</span>
                 </div>
               )) : (
                 <div className="p-12 text-center text-slate-400 italic">No activity recorded this shift.</div>
               )}
            </div>
            <div className="bg-indigo-50 p-6 rounded-[2.5rem] border border-indigo-100">
               <h4 className="text-xs font-black text-indigo-900 uppercase mb-2">HIPAA Notice</h4>
               <p className="text-[10px] text-indigo-700 opacity-80">This history is stored locally in device RAM and is cleared upon app close. No patient-identifiable data is transmitted.</p>
            </div>
          </div>
        );

        // --- MAIN APP ---

        const App = () => {
          const [activeTab, setActiveTab] = useState('consult');
          const [patient, setPatient] = useState({ age: 45, weight: 70, creatinine: 1.0, sex: 'male', isPediatric: false });
          const [logs, setLogs] = useState([]);

          const logAction = (text) => {
             const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
             setLogs(prev => [{text, time}, ...prev].slice(0, 20));
          };

          const crCl = useMemo(() => {
            const factor = patient.sex === 'female' ? 0.85 : 1.0;
            const val = ((140 - Number(patient.age)) * Number(patient.weight) * factor) / (72 * (Number(patient.creatinine) || 1));
            return Math.max(0, Math.round(val));
          }, [patient]);

          return (
            <div className="max-w-md mx-auto bg-[#F8FAFC] h-full flex flex-col font-sans select-none overflow-hidden relative shadow-2xl">
              <style>{`
                html, body { position: fixed; overflow: hidden; width: 100%; height: 100%; -webkit-tap-highlight-color: transparent; }
                #root { height: 100%; overflow: hidden; }
                .scrollbar-hide::-webkit-scrollbar { display: none; }
                .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
                .safe-top { padding-top: env(safe-area-inset-top, 0px); }
                .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 0px); }
                button, input, span, div { -webkit-user-select: none; user-select: none; }
                input { -webkit-user-select: text; user-select: text; }
                body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #F8FAFC; }
              `}</style>

              <div className="bg-indigo-950 p-6 pt-12 pb-8 text-white rounded-b-[4.5rem] shadow-2xl safe-top shrink-0">
                <div className="flex justify-between items-center">
                  <div><h1 className="text-2xl font-black tracking-tighter italic leading-none">OhioID <span className="bg-indigo-600 not-italic text-[10px] px-2 py-0.5 rounded-lg uppercase tracking-widest font-bold tracking-tight">ULTRA</span></h1><p className="text-indigo-300 text-[9px] font-black uppercase tracking-widest mt-2 opacity-70 italic">Central Ohio Acute Suite</p></div>
                  <div className="w-10 h-10 bg-white/10 rounded-2xl flex items-center justify-center border border-white/20 active:bg-white/20 transition-all cursor-pointer"><Icon name="filter" size={20} className="text-white/60" /></div>
                </div>
              </div>
              
              <main className="flex-1 overflow-hidden relative">
                <div className="h-full w-full">
                  {activeTab === 'consult' && <ConsultView patient={patient} setPatient={setPatient} crCl={crCl} logAction={logAction} />}
                  {activeTab === 'sepsis' && <SepsisTool logAction={logAction} />}
                  {activeTab === 'pathogens' && <PathogenSearch logAction={logAction} />}
                  {activeTab === 'brief' && <KnowledgeHub logAction={logAction} />}
                  {activeTab === 'logs' && <LogsView logs={logs} clearLogs={() => setLogs([])} />}
                </div>
              </main>

              <nav className="shrink-0 bg-white/95 backdrop-blur-xl border-t border-slate-100 px-4 pt-4 pb-12 flex justify-between items-center z-50 rounded-t-[3.5rem] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] safe-bottom">
                <button onClick={() => setActiveTab('consult')} className={`flex flex-col items-center gap-1 transition-all active:scale-90 ${activeTab === 'consult' ? 'text-indigo-600' : 'text-slate-400'}`}><Icon name="stethoscope" size={24} /><span className="text-[10px] font-black uppercase tracking-tighter">Guide</span></button>
                <button onClick={() => setActiveTab('pathogens')} className={`flex flex-col items-center gap-1 transition-all active:scale-90 ${activeTab === 'pathogens' ? 'text-indigo-600' : 'text-slate-400'}`}><Icon name="bug" size={24}/><span className="text-[10px] font-black uppercase tracking-tighter">Bugs</span></button>
                <div className="h-18 w-18 bg-indigo-900 rounded-[2.2rem] flex items-center justify-center -mt-20 shadow-2xl border-4 border-[#F8FAFC] active:scale-95 active:rotate-12 transition-all cursor-pointer group" onClick={() => setActiveTab('sepsis')}><Icon name="gauge" size={32} className="text-white" /></div>
                <button onClick={() => setActiveTab('brief')} className={`flex flex-col items-center gap-1 transition-all active:scale-90 ${activeTab === 'brief' ? 'text-indigo-600' : 'text-slate-400'}`}><Icon name="book" size={24} /><span className="text-[10px] font-black uppercase tracking-tighter">Tools</span></button>
                <button onClick={() => setActiveTab('logs')} className={`flex flex-col items-center gap-1 transition-all active:scale-90 ${activeTab === 'logs' ? 'text-indigo-600' : 'text-slate-400'}`}><Icon name="history" size={24} /><span className="text-[10px] font-black uppercase tracking-tighter">Logs</span></button>
              </nav>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
